(()=>{var e={};e.id=612,e.ids=[612],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5943:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>R,routeModule:()=>T,serverHooks:()=>I,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{GET:()=>N,POST:()=>v,PUT:()=>w});var n=t(6559),a=t(8088),s=t(7719),i=t(2190);(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}();let u=Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).object({username:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(3,"Username must be at least 3 characters").max(20,"Username must be less than 20 characters").regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, hyphens, and underscores"),email:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().email("Invalid email address"),password:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one lowercase letter, one uppercase letter, and one number"),confirmPassword:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string(),agreeToTerms:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).boolean().refine(e=>!0===e,"You must agree to the terms and conditions"),referralCode:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string().optional(),deviceInfo:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).object({userAgent:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string(),ip:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).string(),deviceType:Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).enum(["mobile","desktop","tablet"])}).optional()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),l=[{id:1,username:"admin",email:"admin@mrvl.net",password:"$2a$12$LQv3c1yqBWVHxkd0LHAkCOYKHYOTjL8YB9JlK9ZqK9ZqK9ZqK9ZqK",role:"admin",isVerified:!0,verificationToken:null,createdAt:new Date("2025-01-01"),lastLogin:null,profile:{bio:"",country:"",favoriteTeam:"",avatar:"/default-avatar.png"}}];process.env.JWT_SECRET;let c=process.env.EMAIL_VERIFICATION_SECRET||"your-email-verification-secret",d=new Map,m=["10minutemail.com","tempmail.org","guerrillamail.com","mailinator.com","yopmail.com","temp-mail.org","throwaway.email","getnada.com"];function f(e,r){console.log(`[SECURITY] ${new Date().toISOString()} - ${e}:`,r)}async function p(e,r){let t=`${process.env.BASE_URL||"https://mrvl.net"}/verify-email?token=${r}`;console.log(`[EMAIL] Welcome email sent to ${e.email}`),console.log(`[EMAIL] Verification link: ${t}`)}async function O(e){return!l.some(r=>r.username.toLowerCase()===e.toLowerCase())}async function E(e){return!l.some(r=>r.email.toLowerCase()===e.toLowerCase())}async function v(e){try{var r;let t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";if(!function(e){let r=new Date,t=d.get(e);return!t||r.getTime()-t.lastAttempt.getTime()>36e5?(d.set(e,{count:1,lastAttempt:r}),!0):!(t.count>=3)&&(t.count+=1,t.lastAttempt=r,!0)}(t))return f("REGISTRATION_RATE_LIMITED",{ip:t}),i.NextResponse.json({error:"Too many registration attempts. Please try again later."},{status:429});let o=await e.json();try{u.parse(o)}catch(e){if(e instanceof Object(function(){var e=Error("Cannot find module 'zod'");throw e.code="MODULE_NOT_FOUND",e}()).ZodError){let r=e.errors.map(e=>({field:e.path.join("."),message:e.message}));return f("REGISTRATION_VALIDATION_ERROR",{ip:t,errors:r}),i.NextResponse.json({error:"Validation failed",details:r},{status:400})}}let{username:n,email:a,password:s,referralCode:v,deviceInfo:N}=o;if(function(e){let r=e.split("@")[1]?.toLowerCase();return m.includes(r)}(a))return f("REGISTRATION_DISPOSABLE_EMAIL",{ip:t,email:a.split("@")[1]}),i.NextResponse.json({error:"Please use a valid email address"},{status:400});if(!await O(n))return f("REGISTRATION_USERNAME_TAKEN",{ip:t,username:n}),i.NextResponse.json({error:"Username is already taken"},{status:409});if(!await E(a))return f("REGISTRATION_EMAIL_TAKEN",{ip:t,email:a.split("@")[0]+"@***"}),i.NextResponse.json({error:"Email is already registered"},{status:409});let w=await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(s,12),T=null;v&&(T=function(e){let r=l.find(r=>r.username===e);return r?(console.log(`[REFERRAL] New user referred by ${r.username}`),{valid:!0,referrerId:r.id}):{valid:!1,referrerId:null}}(v));let _={id:l.length+1,username:n,email:a,password:w,role:"user",isVerified:!1,verificationToken:null,createdAt:new Date,lastLogin:null,profile:{bio:"",country:"",favoriteTeam:"",avatar:"/default-avatar.png"},referredBy:T?.referrerId||null,registrationIp:t,deviceInfo:N||null},g=(r=_.id,Object(function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}())({userId:r,email:a,type:"email_verification"},c,{expiresIn:"24h",issuer:"mrvl.net"}));return _.verificationToken=g,l.push(_),await p(_,g),f("REGISTRATION_SUCCESS",{userId:_.id,username:_.username,email:a.split("@")[0]+"@***",ip:t,hasReferral:!!v}),i.NextResponse.json({success:!0,message:"Account created successfully! Please check your email to verify your account.",user:{id:_.id,username:_.username,email:_.email,role:_.role,isVerified:_.isVerified,createdAt:_.createdAt},requiresVerification:!0},{status:201})}catch(e){return console.error("Registration error:",e),f("REGISTRATION_ERROR",{error:e.message}),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function N(e){try{let{searchParams:r}=new URL(e.url),t=r.get("username"),o=r.get("email");if(t){let e=await O(t);return i.NextResponse.json({available:e,username:t})}if(o){let e=await E(o);return i.NextResponse.json({available:e,email:o.split("@")[0]+"@***"})}return i.NextResponse.json({error:"Username or email parameter required"},{status:400})}catch(e){return console.error("Availability check error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function w(e){try{let r;let{token:t}=await e.json();if(!t)return i.NextResponse.json({error:"Verification token is required"},{status:400});try{r=Object(function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}())(t,c)}catch(e){return f("EMAIL_VERIFICATION_INVALID_TOKEN",{token:t.substring(0,10)+"..."}),i.NextResponse.json({error:"Invalid or expired verification token"},{status:400})}let o=l.findIndex(e=>e.id===r.userId&&e.email===r.email);if(-1===o)return i.NextResponse.json({error:"User not found"},{status:404});return l[o].isVerified=!0,l[o].verificationToken=null,f("EMAIL_VERIFICATION_SUCCESS",{userId:l[o].id,username:l[o].username}),i.NextResponse.json({success:!0,message:"Email verified successfully! You can now log in to your account."})}catch(e){return console.error("Email verification error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let T=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/var/www/mrvl-frontend/frontend/src/app/api/auth/register/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:_,workUnitAsyncStorage:g,serverHooks:I}=T;function R(){return(0,s.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:g})}},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[447,580],()=>t(5943));module.exports=o})();