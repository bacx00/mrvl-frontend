(()=>{var e={};e.id=758,e.ids=[758],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9277:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>O,serverHooks:()=>k,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{DELETE:()=>m,POST:()=>p,PUT:()=>f});var n=t(6559),o=t(8088),i=t(7719),a=t(2190);(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module 'express-rate-limit'");throw e.code="MODULE_NOT_FOUND",e}(),Object(function(){var e=Error("Cannot find module 'express-rate-limit'");throw e.code="MODULE_NOT_FOUND",e}())({windowMs:9e5,max:5,message:"Too many login attempts, please try again later.",standardHeaders:!0,legacyHeaders:!1});let u=[{id:1,username:"admin",email:"admin@mrvl.net",password:"$2a$12$LQv3c1yqBWVHxkd0LHAkCOYKHYOTjL8YB9JlK9ZqK9ZqK9ZqK9ZqK",role:"admin",isVerified:!0,twoFactorEnabled:!1,loginAttempts:0,lockUntil:null,createdAt:new Date("2025-01-01"),lastLogin:null},{id:2,username:"editor",email:"editor@mrvl.net",password:"$2a$12$8EXAMPLE8HASH8FOR8EDITOR8PASSWORD8",role:"editor",isVerified:!0,twoFactorEnabled:!1,loginAttempts:0,lockUntil:null,createdAt:new Date("2025-01-01"),lastLogin:null},{id:3,username:"testuser",email:"user@mrvl.net",password:"$2a$12$9EXAMPLE9HASH9FOR9USER9PASSWORD9",role:"user",isVerified:!0,twoFactorEnabled:!1,loginAttempts:0,lockUntil:null,createdAt:new Date("2025-01-01"),lastLogin:null}],l=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";function d(e,r){console.log(`[SECURITY] ${new Date().toISOString()} - ${e}:`,r)}function c(e,r=!1){let t={id:e.id,username:e.username,email:e.email,role:e.role,isVerified:e.isVerified};return{accessToken:Object(function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}())(t,l,{expiresIn:"24h",issuer:"mrvl.net",audience:"mrvl-users"}),refreshToken:Object(function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}())({userId:e.id},l,{expiresIn:r?"30d":"7d",issuer:"mrvl.net",audience:"mrvl-refresh"})}}async function p(e){try{let r=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",{username:t,email:s,password:n,rememberMe:o=!1,deviceInfo:i}=await e.json();if(!n)return d("LOGIN_ATTEMPT_NO_PASSWORD",{ip:r}),a.NextResponse.json({error:"Password is required"},{status:400});if(!t&&!s)return d("LOGIN_ATTEMPT_NO_IDENTIFIER",{ip:r}),a.NextResponse.json({error:"Username or email is required"},{status:400});let l=u.find(e=>e.username===t||e.email===s);if(!l)return d("LOGIN_ATTEMPT_USER_NOT_FOUND",{username:t,email:s,ip:r}),a.NextResponse.json({error:"Invalid credentials"},{status:401});if(null!==l.lockUntil&&l.lockUntil>new Date)return d("LOGIN_ATTEMPT_ACCOUNT_LOCKED",{userId:l.id,username:l.username,ip:r}),a.NextResponse.json({error:"Account is temporarily locked due to too many failed attempts"},{status:423});if(!l.isVerified)return d("LOGIN_ATTEMPT_UNVERIFIED",{userId:l.id,username:l.username,ip:r}),a.NextResponse.json({error:"Please verify your email address before logging in",requiresVerification:!0,email:l.email},{status:403});if(!await Object(function(){var e=Error("Cannot find module 'bcryptjs'");throw e.code="MODULE_NOT_FOUND",e}())(n,l.password))return l.loginAttempts+=1,l.loginAttempts>=5&&(l.lockUntil=new Date(Date.now()+18e5),d("ACCOUNT_LOCKED",{userId:l.id,username:l.username,attempts:l.loginAttempts})),d("LOGIN_ATTEMPT_WRONG_PASSWORD",{userId:l.id,username:l.username,attempts:l.loginAttempts,ip:r}),a.NextResponse.json({error:"Invalid credentials"},{status:401});l.loginAttempts=0,l.lockUntil=null,l.lastLogin=new Date;let{accessToken:p,refreshToken:m}=c(l,o);d("LOGIN_SUCCESS",{userId:l.id,username:l.username,ip:r,deviceInfo:i||"unknown",rememberMe:o});let f={success:!0,user:{id:l.id,username:l.username,email:l.email,role:l.role,isVerified:l.isVerified,lastLogin:l.lastLogin},tokens:{accessToken:p,refreshToken:m,expiresIn:"24h"}},O=a.NextResponse.json(f);return O.cookies.set("mrvl_access_token",p,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"}),O.cookies.set("mrvl_refresh_token",m,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:o?2592e3:604800,path:"/"}),O}catch(e){return console.error("Login error:",e),d("LOGIN_ERROR",{error:e.message}),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e){try{let e=a.NextResponse.json({success:!0,message:"Logged out successfully"});return e.cookies.delete("mrvl_access_token"),e.cookies.delete("mrvl_refresh_token"),e}catch(e){return console.error("Logout error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){try{let r=e.cookies.get("mrvl_refresh_token")?.value;if(!r)return a.NextResponse.json({error:"Refresh token not found"},{status:401});let t=Object(function(){var e=Error("Cannot find module 'jsonwebtoken'");throw e.code="MODULE_NOT_FOUND",e}())(r,l),s=u.find(e=>e.id===t.userId);if(!s)return a.NextResponse.json({error:"User not found"},{status:401});let{accessToken:n,refreshToken:o}=c(s),i=a.NextResponse.json({success:!0,tokens:{accessToken:n,refreshToken:o,expiresIn:"24h"}});return i.cookies.set("mrvl_access_token",n,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"}),i.cookies.set("mrvl_refresh_token",o,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:604800,path:"/"}),i}catch(e){return console.error("Token refresh error:",e),a.NextResponse.json({error:"Invalid refresh token"},{status:401})}}let O=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/var/www/mrvl-frontend/frontend/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:_,workUnitAsyncStorage:g,serverHooks:k}=O;function h(){return(0,i.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:g})}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580],()=>t(9277));module.exports=s})();